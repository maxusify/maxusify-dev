---
import PostGrid from '@/components/blog/PostGrid.astro'
import PostItem from '@/components/blog/PostItem.astro'
import PostTag from '@/components/blog/PostTag.astro'
import { BLOG_TAGS } from '@/constants/blog-tags'
import PageLayout from '@/layouts/PageLayout.astro'

export async function getStaticPaths() {
  const allPosts: any = await Astro.glob('../posts/*.{md,mdx}')

  return BLOG_TAGS.map((tag) => ({
    params: { tag },
    props: { posts: allPosts }
  }))
}

const { tag } = Astro.params
const { posts } = Astro.props

const filteredPosts = posts.filter((post: any) =>
  post.frontmatter.tags?.includes(tag)
)

export const prerender = true
---

<PageLayout title={`#${tag}`}>
  <div class='wrapper'>
    <h1>Posts tagged with <code>#{tag}</code></h1>

    <section class='blog'>
      <PostGrid>
        {
          filteredPosts.map((post: any) => (
            <PostItem url={post.url} {...post.frontmatter} />
          ))
        }
      </PostGrid>
    </section>
  </div>
</PageLayout>

<style>
  .wrapper {
    @apply flex w-full flex-col items-center justify-center;
  }

  .wrapper h1 {
    @apply mb-10 flex w-full justify-center gap-2 text-4xl font-bold text-rose-400;
  }
</style>
